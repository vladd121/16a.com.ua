

function isNumeric(n) {
 
  return !isNaN(parseFloat(n)) && isFinite(n);
}

function ChangeNumAdd(n, inputID) {
 if (n=="") {return; }
 
if (!isNumeric(n) || (n<0) ) {
		document.getElementById(inputID).value = 1;
//		document.getElementById(inputID).	
	}
}

function ChangeNumAddTT(n, inputID) {
 if (n=="") {return; }
 
if (!isNumeric(n) || (n<0) ) {
		document.getElementById(inputID).value = 1;
//		document.getElementById(inputID).	
	}
}


function onkeypressAddItem(e,butID) {
 var keynum = "";
// var keychar;
// var numcheck;
//ChangeNumAdd(n, inputID);
//alert(e+",   "+butID);

if(window.event) // IE
 {
  keynum = e.keyCode;
 }
 else if(e.which) // Netscape/Firefox/Opera
 {
  keynum = e.which;
 }
 if(keynum == 13) document.getElementById(butID).click();
}








function addbasket(param) {
	var statusWait = document.getElementById('vote_my_wait'+param.BuyItem);
	var StatusMini_basket = document.getElementById('mini_basket');
	var statusButton = document.getElementById(param.butId);
	var statusAddInput = document.getElementById('tdAddNum'+param.BuyItem); 
	
	if (!isNumeric(param.AddNum) || (param.AddNum<1) ) {
		param.AddNum = 1;	
	}

    statusWait.innerHTML = '<img src="./images/wait.gif">';

	
	$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	'BuyItem='+param.BuyItem+'&'+'AddNum='+param.AddNum,
		success: function(response){ 
			statusWait.innerHTML = "";
//			statusButton.value = "в кошику";
			statusButton.className = "addbuttonNowInBasket";
		//	$('#tdAddNum'+param.BuyItem).html('привет');
			var arr = response.split("<split-request>", 3);
			StatusMini_basket.innerHTML = arr[0];
			statusButton.value = arr[1];
			statusAddInput.innerHTML = param.itemPrice+arr[2]+param.AddNum;
		//	tovItemOver(param.BuyItem); //для коррекції положення layer2
			statusButton.onclick=function(){clickButNowInBasket({BuyItem:param.BuyItem, Price:param.itemPrice});};
			//alert('Сервер вернул ответ: ' + response);
		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});	
	
	

	
}


function clickButNowInBasket_old(param) {
	var statusWait = document.getElementById('vote_my_wait'+param.BuyItem);
	
    statusWait.innerHTML = '<img src="./images/wait.gif">';
	
	$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	'ButNowInBasket='+param.BuyItem,
		success: function(response){ 
			statusWait.innerHTML = "";
			document.getElementById('my_popup').innerHTML =response;
			$('#AddNumTT').keyup(function(){ChangeNumAddTT(document.getElementById('AddNumTT').value, 'AddNumTT'); });
			$('#AddNumTT').on('keypress', function(e){onkeypressAddItem(e, 'ButtonTT');});
			$('#ButtonTT').click(function(){editItemFromPopUp(param.BuyItem, document.getElementById('AddNumTT').value, param.Price);}); 
			$('#AddNumTT').focus();
			
			//alert('Сервер вернул ответ: ' + response);
		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});	

	

}

function clickButNowInBasket(param) {
	var statusWait = document.getElementById('vote_my_wait'+param.BuyItem);
	
    statusWait.innerHTML = '<img src="./images/wait.gif">';
	
	$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	'ButNowInBasket='+param.BuyItem,
		success: function(response){ 
			statusWait.innerHTML = "";
			
		    $("#dialog").dialog(
		    	    {
		   // 	    height: 400,
		   // 	    width:350,
		    //	    open: function() { $(".ui-dialog").css("box-shadow","0 0 10px rgba(0,0,0,0.5)"); }
//		    	    open: function() { $(".ui-dialog").css("box-shadow","#000 5px 5px 5px"); }
		    	    open: function() { $(".ui-dialog").css({'box-shadow':'10px 10px 5px rgba(0,0,0,0.6)','-moz-box-shadow':'10px 10px 5px rgba(0,0,0,0.6)', '-webkit-box-shadow':'10px 10px 5px rgba(0,0,0,0.6)'});}
		    	    //0 0 10px rgba(0,0,0,0.5)
		     });


	//	    $( "#dialog" ).dialog({ height: 380 });
	//	    $( "#dialog" ).dialog({ width: 320 });
		    $( "#dialog" ).dialog({ minWidth: 300 });
		    $( "#dialog" ).dialog({ minHeight: 320 });
	//	$( "#dialog" ).dialog({ autoOpen: false });
		//	$( "#dialog" ).dialog({ modal: true });
			$( "#dialog" ).dialog({ show: "slide" }); //slide
//			$( "#dialog" ).dialog({ show: "fold" }); 
//			$( "#dialog" ).dialog({ hide: "explode" });
			$( "#dialog" ).dialog({ hide: "slide" });

			var arr = response.split("<split-request>");
			document.getElementById('dialog').innerHTML =arr[0];
			$( "#dialog" ).dialog({ closeText: arr[1] });
			$( "#dialog" ).dialog({ title: arr[2] });
			$( "#dialog" ).dialog({ buttons: [ { text: arr[3], click: function() {$( "#dialog" ).dialog({ hide: "null" });  $( this ).dialog( "close" ); location.href='?page=basket'; } },
			                                   { text: arr[4], click: function() { $( this ).dialog( "close" ); } } ] });

			$('#AddNumTT').keyup(function(){ChangeNumAddTT(document.getElementById('AddNumTT').value, 'AddNumTT'); });
			$('#AddNumTT').on('keypress', function(e){onkeypressAddItem(e, 'ButtonTT');});
			$('#ButtonTT').click(function(){editItemFromPopUp(param.BuyItem, document.getElementById('AddNumTT').value, param.Price);}); 
			$( "#dialog" ).dialog( "open" );
//			$('#AddNumTT').focus();
			var form = document.forms.form_popup_now_in_basket;
		//	form.style.display = 'block';
			setTimeout(function() { form.elements.AddNum.focus(); }, 500);
			
			
			//alert('Сервер вернул ответ: ' + response);
		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});	

	

}



function editItemFromPopUp(BuyItem, AddNumTT, Price) {
	
	var StatusMini_basket = document.getElementById('mini_basket');
	var statusButton = document.getElementById("Button"+BuyItem);
	var statusAddInput = document.getElementById('tdAddNum'+BuyItem); 
	var statusWait = document.getElementById('vote_my_wait_popup');
	
    statusWait.innerHTML = '<img src="./images/wait.gif">';
	
	if (!isNumeric(AddNumTT) || (AddNumTT<0) ) {
		AddNumTT = 1;	
	}
	
    
	$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	'BuyItem='+BuyItem+'&'+'AddNum='+AddNumTT,
		success: function(response){ 
//			document.getElementById('popup').style.display='none';
//			document.getElementById('TB_overlay').style.display='none';
//			document.getElementById('my_popup').innerHTML = '';
//			statusWait.innerHTML = '';
			var arr = response.split("<split-request>");
			StatusMini_basket.innerHTML = arr[0];
			statusAddInput.innerHTML = Price+arr[2]+AddNumTT;
			if (AddNumTT == 0) {statusButton.value = arr[3]; statusButton.className = "addbutton";} else {statusButton.value = arr[4]; statusButton.className = "addbuttonNowInBasket";}
			$("#dialog").dialog( "close" );
			//alert('Сервер вернул ответ: ' + response);
		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});	

	
	
}



function editbasket(param) {
	var statusWait = document.getElementById('vote_my_wait'+param.editBuyItem);
	var StatusBasket = document.getElementById('basket_status');
	var StatusMini_basket = document.getElementById('mini_basket');
	
  	statusWait.innerHTML = '<img src="./images/wait.gif">';
  	
  	send=""; //editBuyItem
  	for (var i in param.data) send+= i+"="+param.data[i]+"&";
  	
	$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	send,
		success: function(response){ 
			statusWait.innerHTML = "";
			var arr = response.split("<split-request>");
			StatusBasket.innerHTML = arr[0];
			StatusMini_basket.innerHTML = arr[1];
			//editbasket_query2();
		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});	

	
	
}



function onkeypressSearch(e, input_id) {
	 var keynum = "";
	// var keychar;
	// var numcheck;
	//ChangeNumAdd(n, inputID);
	//alert(e+",   "+butID);

	if(window.event) // IE
	 {
	  keynum = e.keyCode;
	 }
	 else if(e.which) // Netscape/Firefox/Opera
	 {
	  keynum = e.which;
	 }
	 if(keynum == 13) {
		 document.getElementById('searchInputHide').value = document.getElementById(input_id).value;
		 document.forms.searchformHide.submit();

	 }
	

}

function onSearchButClick(input_id) {
		 document.getElementById('searchInputHide').value = document.getElementById(input_id).value;
		 document.forms.searchformHide.submit();

}





function SearchClick_no_use()  {
	var statusMain = document.getElementById('main_page');
	var searchString = document.getElementById('searchInput').value;
	document.getElementById('searchInput').value = "";
	$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	'getSearch='+searchString,
		success: function(response){ 
		//	statusWait.innerHTML = "";
			statusMain.innerHTML = response;
		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});	
	
}


function searchItenResultClick(kod)  {
	var statusSearch_show_item = document.getElementById('search_show_item'+kod);
	$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	'getSearchItem='+kod,
		success: function(response){ 
		//	statusWait.innerHTML = "";
			statusSearch_show_item.innerHTML = response;
		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});	
	
}


function next_item_button(nowItemStart, sString) {
	
	var search_portion = document.getElementById('search_portion'+nowItemStart);
	
	$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	'search_portionString='+sString+'&nowItemStart='+nowItemStart,
		success: function(response){ 
			search_portion.innerHTML = response;
		//	$("#search_portion"+nowItemStart).append(response);
			
		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});	
	
}



function MM_preloadImages() { //v3.0
 var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
   var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
   if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}
function MM_swapImgRestore() { //v3.0
  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;
}
function MM_findObj(n, d) { //v4.01
  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {
    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}
  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];
  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);
  if(!x && d.getElementById) x=d.getElementById(n); return x;
}

function MM_swapImage() { //v3.0
  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)
   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}
}
function tovItemOver(kod) {

	
//	var tw = document.getElementById('tov-wrap'+kod);
//	var tb = document.getElementById('tov-box'+kod);
//	var ti = document.getElementById('tov-i'+kod);
//	tw.className = "price-item-wrap1-ie-hover";
//	tb.className = "gtile-i-box-ie-hover";
	//ti.className = "gtile-i-ie-hover";
//	var offset = $(ti).offset(); 

	
//	var l2= document.getElementById('hover_item'+kod);
//	$(l2).offset({top:offset.top, left:offset.left});
 //   l2.className = "price-item-wrap1";
  //  l2.innerHTML = "dasdfasdfasdasdasdasd adasd dfgdfg <br>dasdfasdfasdasdasdasd adasd dfgdfg <br>dasdfasdfasdasdasdasd adasd dfgdfg <br>";
//	$(ti).css("overflow", "visible");
//	$(ti).offset({top:0, left:0});
//	$(ti).offset({top:offset.top, left:offset.left});

//    $(ti).offset({top:offset.top, left:offset.left});
	 
	 
//	var tovInfo = document.getElementById('tovInfo'+kod);
//	var offset = $(tovInfo).offset(); 
//	 l2.innerHTML = $(tovInfo).html();
//	 l2.className = "price-item-wrap1-full";
	// $(l2).offset({top:offset.top, left:offset.left});
	 //l2.className = "price-item-hover2";
	 
}

function tovItemOut(kod) {

//	var l2= document.getElementById('hover_item'+kod);
//	$(l2).offset({top:offset.top, left:offset.left});
 //   l2.className = "";

	
	//	document.getElementById('tovItemShop'+kod).className = "price-item-wrap1";
//	var l2= document.getElementById('hover_item');
//	l2.className = "";
//	l2.innerHTML = "";
}


function MM_openBrWindow(theURL,winName,features) { 
	  window.open(theURL,winName,features);

}

function selectedColorFonMenu(idCell) {
	var l2= document.getElementById(idCell);
    l2.className = "menuTd1-selected";
	var l2= document.getElementById(idCell+'1');
    l2.className = "menuTd1-link-selected";



}

function show_j_dialog()
{

//	$( "#dialog" ).dialog({ autoOpen: false });
	//$( "#dialog_delivery" ).dialog({ modal: true });
 //   $( "#dialog_delivery" ).dialog({ height: 400 });
 //   $( "#dialog_delivery" ).dialog({ width: 600 });
    $( "#dialog_delivery" ).dialog({ minWidth: 600 });
    $( "#dialog_delivery" ).dialog({ minHeight: 300 });


//	$( "#dialog_delivery" ).dialog({ closeText: "закрити" });
	$( "#dialog_delivery" ).dialog({ show: "fold" });

	$( "#dialog_delivery" ).dialog({ hide: "slide" });
	$( "#dialog_delivery" ).dialog({ buttons: [ { text: "Ok", click: function() { $( this ).dialog( "close" ); } } ] });
	
    $("#dialog_delivery").dialog(
    	    {
    	    open: function() { $(".ui-dialog").css({'box-shadow':'10px 10px 5px rgba(0,0,0,0.6)','-moz-box-shadow':'10px 10px 5px rgba(0,0,0,0.6)', '-webkit-box-shadow':'10px 10px 5px rgba(0,0,0,0.6)'});}
     });

    $( "#dialog_delivery" ).dialog({
		close: function( event, ui ) {
		setTimeout(function() {is_modal=false; }, 500);
		}
		});

    if (is_modal) {
		setTimeout(function() {
			is_modal = true;
			$( "#dialog_delivery" ).dialog({ modal: true});
			$( "#dialog_delivery" ).dialog( "open" ); }, 1000);
		}
	else {
		is_modal = true;
		$( "#dialog_delivery" ).dialog({ modal: true});
		$( "#dialog_delivery" ).dialog( "open" );
		}
		

}


function truncate_basket() {
	//var statusWait = document.getElementById('vote_my_wait'+param.editBuyItem);
	var StatusBasket = document.getElementById('basket_status');
	var StatusMini_basket = document.getElementById('mini_basket');
	
	$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	'truncate_basket=1',
		success: function(response){ 
//			statusWait.innerHTML = '';
			var arr = response.split("<split-request>");
			StatusBasket.innerHTML = arr[0];
			StatusMini_basket.innerHTML = arr[1];
		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});		
}


function show_truncate_basket_dialog()
{

    $("#dialog_truncate").dialog(
    	    {
    	    open: function() { $(".ui-dialog").css({'box-shadow':'10px 10px 5px rgba(0,0,0,0.6)','-moz-box-shadow':'10px 10px 5px rgba(0,0,0,0.6)', '-webkit-box-shadow':'10px 10px 5px rgba(0,0,0,0.6)'});}
     });

    $( "#dialog_truncate" ).dialog({ minHeight: 150 });
    $( "#dialog_truncate" ).dialog({ minWidth: 300 });
 //   $( "#dialog_truncate" ).dialog({ height: 250 });
 //   $( "#dialog_truncate" ).dialog({ width: 400 });
//	$( "#dialog" ).dialog({ show: "slide" }); //slide
	$( "#dialog_truncate" ).dialog({ show: "fold" }); 
	$( "#dialog_truncate" ).dialog({ hide: "slide" });
//	$( "#dialog" ).dialog({ hide: "slide" });

	$( "#dialog_truncate" ).dialog( "open" );
}

function open_basket_dialog() {
	
	$("#dialog_form").dialog(
    	    {
    	    open: function() { $(".ui-dialog").css({'box-shadow':'10px 10px 5px rgba(0,0,0,0.6)','-moz-box-shadow':'10px 10px 5px rgba(0,0,0,0.6)', '-webkit-box-shadow':'10px 10px 5px rgba(0,0,0,0.6)'});}
     });
    $( "#dialog_form" ).dialog({ minHeight: 300 });
    $( "#dialog_form" ).dialog({ minWidth: 750 });
	$( "#dialog_form" ).dialog({ show: "fold" }); 
	$( "#dialog_form" ).dialog({ hide: "fold" });
	$( "#dialog_form" ).dialog({
		close: function( event, ui ) {
			
		document.getElementById('user_name_text').style.display='none';
		document.getElementById('user_phone_text').style.display='none';
	//	setTimeout(function() {is_modal=false; }, 500);
		}
		});
/*	if (is_modal) {
		setTimeout(function() {
			is_modal = true;
			$( "#dialog_form" ).dialog({ modal: true});
			$( "#dialog_form" ).dialog( "open" ); }, 1000);
		}
	else {
	
		is_modal = true;
		$( "#dialog_form" ).dialog({ modal: true});
*/

		$( "#dialog_form" ).dialog( "open" );
//		}
		
	
	
}

function truncate_basket() {
	//var statusWait = document.getElementById('vote_my_wait'+param.editBuyItem);
	var StatusBasket = document.getElementById('basket_status');
	var StatusMini_basket = document.getElementById('mini_basket');
	
	$( "#dialog_form" ).dialog({ buttons: [ { disabled: true}]});
	
		$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	'truncate_basket=1',
		success: function(response){ 
//			statusWait.innerHTML = '';
			var arr = response.split("<split-request>");
			StatusBasket.innerHTML = arr[0];
			StatusMini_basket.innerHTML = arr[1];
		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});		
}


function send_basket_dialog(param) {

	
	var statusWait = document.getElementById('send_my_wait');
	var StatusBasket = document.getElementById('basket_status');
	var StatusMini_basket = document.getElementById('mini_basket');
  	statusWait.innerHTML = '<img src="./images/wait.gif">';

  	//$("#dialog_form").dialog( "option", { disabled: true } );
	$('#dialogSendbut').button( "option", "disabled", true );
  	
  	
  	send = "";
	for (var i in param.data) send+= i+"="+param.data[i]+"&";
	$.ajax({
		url:	 './index.php',
		type:	 'POST',
		data:	send,
		success: function(response){ 
			statusWait.innerHTML = '';
			var arr = response.split("<split-request>");
			var res_error = false; 
			
			if (arr[1] == 'name_error') {res_error = true; document.getElementById('user_name_text').style.display='inline';}
			else {document.getElementById('user_name_text').style.display='none';}
		
			if (arr[2] == 'phone_error') {res_error = true; document.getElementById('user_phone_text').style.display='inline';}
			else {document.getElementById('user_phone_text').style.display='none';}
			

			if (!res_error) {
				StatusBasket.innerHTML = arr[0];
				StatusMini_basket.innerHTML = arr[1];
				$("#dialog_form").dialog( "close" );
				
				//<!-- Google Code for SendBasket Conversion Page -->
				var google_conversion_id = 1001418804;
				var google_conversion_language = "en";
				var google_conversion_format = "3";
				var google_conversion_color = "ffffff";
				var google_conversion_label = "4onPCKH2o3MQtODB3QM";
				var google_remarketing_only = false;
				
				$.getScript('//www.googleadservices.com/pagead/conversion.js');
				
				var image = new Image(1, 1); 
	          image.src = "//www.googleadservices.com/pagead/conversion/1001418804/?label=4onPCKH2o3MQtODB3QM&amp;guid=ON&amp;script=0";
		          

				document.location.href = "#";

			}

			$('#dialogSendbut').button( "option", "disabled", false );

		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});		

}

function show_full_pic(pic) {
    $("#dialog_pic_full").dialog(
    	    {
    	    open: function() { $(".ui-dialog").css({'box-shadow':'0 0 25px rgba(0,0,0,0.9)','-moz-box-shadow':'0 0 25px rgba(0,0,0,0.9)', '-webkit-box-shadow':'0 0 25px rgba(0,0,0,0.9)'});}
     });

   $( "#dialog_pic_full" ).dialog({ minHeight: 300 });
    $( "#dialog_pic_full" ).dialog({ minWidth: 300 });
 //   $( "#dialog_pic_full" ).dialog({ maxHeight: 500 });
  //  $( "#dialog_pic_full" ).dialog({ maxWidth: 800 });
    $( "#dialog_pic_full" ).dialog({ height: 500 });
    $( "#dialog_pic_full" ).dialog({ width: 800 });
//	$( "#dialog" ).dialog({ show: "slide" }); //slide
	$( "#dialog_pic_full" ).dialog({ show: "fold" }); 
	$( "#dialog_pic_full" ).dialog({ hide: "fade" });
//	$( "#dialog" ).dialog({ hide: "slide" });
	var pic_in = "";
	pic_in = "<img src='photo/"+pic+"' border='1' />";
	//<img src="photo/preview/nashasila/ts.jpg width=" 50'="" border="1" height="50">
	document.getElementById('dialog_pic_full').innerHTML = pic_in;
	$( "#dialog_pic_full" ).dialog( "open" );

//	$( "#dialog_pic_full" ).dialog({ buttons: [ { text: "Ok", click: function() {$(this).dialog( "close" ); }  }]});
}



function show_full_pic_gal4(pic) {
    $("#dialog_pic_full").dialog(
    	    {
    	    open: function() { $(".ui-dialog").css({'box-shadow':'0 0 25px rgba(0,0,0,0.9)','-moz-box-shadow':'0 0 25px rgba(0,0,0,0.9)', '-webkit-box-shadow':'0 0 25px rgba(0,0,0,0.9)'});}
     });

   $( "#dialog_pic_full" ).dialog({ minHeight: 300 });
    $( "#dialog_pic_full" ).dialog({ minWidth: 300 });
 //   $( "#dialog_pic_full" ).dialog({ maxHeight: 500 });
  //  $( "#dialog_pic_full" ).dialog({ maxWidth: 800 });
    $( "#dialog_pic_full" ).dialog({ height: 500 });
    $( "#dialog_pic_full" ).dialog({ width: 800 });
//	$( "#dialog" ).dialog({ show: "slide" }); //slide
	$( "#dialog_pic_full" ).dialog({ show: "fold" }); 
	$( "#dialog_pic_full" ).dialog({ hide: "fade" });
//	$( "#dialog" ).dialog({ hide: "slide" });
	var pic_in = "";
	pic_in = "<img src='"+pic+"' border='1' />";
	//<img src="photo/preview/nashasila/ts.jpg width=" 50'="" border="1" height="50">
	document.getElementById('dialog_pic_full').innerHTML = pic_in;
	$( "#dialog_pic_full" ).dialog( "open" );

//	$( "#dialog_pic_full" ).dialog({ buttons: [ { text: "Ok", click: function() {$(this).dialog( "close" ); }  }]});
}



var change_focus_after_press_enter = false;

function onkeypressPriceFilter(e,filter, init_val, value, def, defStart, defStop, inputID) { //контроль натискання клавіши Enter у фільтрі цін

	if(value==def){
		document.getElementById(inputID).value="";
	}

	var keynum = "";

	 if(window.event) // IE
	 {
	  keynum = e.keyCode;
	 }
	 else if(e.which) // Netscape/Firefox/Opera
	 {
	  keynum = e.which;
	 }
	 if(keynum == 13) changePriceFilter(value, def, filter, init_val,  defStart, defStop, "");//натиснуто  Enter
	}




function ChangeNumPriceFilter(n, def, inputID) { //відпущено клавішу в полі вводу ціни *
	//console.log("up");
	if (n=="") {n=def;}
	if (!isNumeric(n) || (n<0) ) {
			document.getElementById(inputID).className = "minmax-price-user-error";
			return;
		}
	
	if (n!=def) {
		document.getElementById(inputID).className = "minmax-price-user";
	}else{
		document.getElementById(inputID).className = "minmax-price";
	}

}

function ChangeNumPriceFilterOut(n, def, filter, init_val, defStart, defStop, inputID) { //втрата фокусу полем ціна
	//console.log("out");
	if (!change_focus_after_press_enter){
		if (n=="") {n=def; document.getElementById(inputID).value=def;}
		changePriceFilter(n, def, filter, init_val,  defStart, defStop);
	}

}



function changePriceFilter(n, def, filter, init_val,  defStart, defStop) {
	//console.log(defStart);
	
	//console.log(n);
	
	if (n=="") {n=def; }
		if (!isNumeric(n) || (n<0) ) {
				return;
			}

	
	p_start = document.getElementById("pr-start").value;
	p_stop = document.getElementById("pr-stop").value;

	if(p_start=="" || !isNumeric(p_start)){p_start=defStart;}
	if(p_stop=="" || !isNumeric(p_stop)){p_stop=defStop;}

	if (init_val!=n){//переходимо якщо значення змінилось
			if((p_start!=defStart) & (p_stop!=defStop)){
				href = filter+"&price_min="+p_start+"&price_max="+ p_stop;
			}else if(p_start==defStart & p_stop!=defStop){
				href = filter+"&price_max="+ p_stop;
			}else if(p_start!=defStart & p_stop==defStop){
				href = filter+"&price_min="+p_start;
			}else{
				href = filter;
			}
			
	
//	change_focus_after_press_enter = true;
//	document.location.href = href;
	
	//update_filter_price_no_reload_page(href.substring(1), 'price_filter');
	//update_filter_price_no_reload_page(page_head_info, 'price_filter');
	update_filter_price_no_reload_page(href.substring(1), 'price_filter');
//	console.log(href.substring(1));
	}
}




function update_filter_price_no_reload_page(no_reload_param, vlast_zn_code) { //змінює і елементи і фільтри

	
	
// щоб події задані через jquery оброблялись після оновлення змісту без перезавантаження сторінки. Але якщо динамічно міняти сам рядок, то він всеодно їгнорується.

//	$('body').on('keypress', '#pr-start', function(e){onkeypressPriceFilter(e, '%%filter%%', '%%init_val_start%%', document.getElementById('pr-start').value, %%def-pr-start%%, %%def-pr-start%%, %%def-pr-stop%%, 'pr-start');});

//	console.log('wait_im1_'+vlast_zn_code);
	var statusWait = document.getElementById('wait_im1_'+vlast_zn_code);
	statusWait.innerHTML = '<img src="./images/wait.gif" width="49" height="50">';
	
	var status_elements_zone = document.getElementById('elements-zone');
	status_elements_zone.className = "cl-price-item-loading";
	var status_vlast_zone = document.getElementById('vlast-zone');
	var new_http_state = "?"+no_reload_param; 

	var status_pda_url_zone = document.getElementById('pda_url');

	var status_pda_url_zone_constant = document.getElementById('pda_url_constant');

	//var new_title = "WTN "+no_reload_param;
	//var new_title = page_head_info;
	
	no_reload_param += "&elements_only=true";
	
//	console.log("old: " + old_location);
//	console.log("new: " + new_http_state);
	
//	console.log(new_http_state);
	
	//var StatusMini_basket = document.getElementById('mini_basket');
	
//	$( "#dialog_form" ).dialog({ buttons: [ { disabled: true}]});
	
		$.ajax({
		url:	 './index.php',
		type:	 'GET',
		data:	no_reload_param,
		success: function(response){ 
			statusWait.innerHTML = '';
/*			var arr = response.split("<split-request>");
			StatusBasket.innerHTML = arr[0];
			StatusMini_basket.innerHTML = arr[1];
*/
		//	status_elements_zone.innerHTML =response;
			var arr = response.split("<split-request>");
			status_elements_zone.innerHTML =arr[0];
			status_vlast_zone.innerHTML =arr[1];
			var new_title_page_from_server = arr[2];
			status_pda_url_zone.innerHTML =arr[3];
			status_pda_url_zone_constant.innerHTML =arr[4];
			
//			var stateObj = { lnk: old_location };
			var stateObj = { lnk: new_http_state, new_title: new_title_page_from_server};
			
			window.history.pushState(stateObj, '', new_http_state); //треба обробляти window.onpopstate, щоб був перехід при поверненні назад

			document.title = new_title_page_from_server;
			
			ga('set', 'page', new_http_state);
			ga('send', 'pageview');	
		
			
			
			
			status_elements_zone.className = "cl-price-item";

		},
		error:  function(xhr, str){alert('Возникла ошибка: ' + xhr.responseCode +", " +str);}
	});		
}


function change_zn_no_reload_page(href, vlast_zn_code){
	//console.log(vlast_zn_code);
	update_filter_price_no_reload_page(href.substring(1), vlast_zn_code);
	//window.location='href';
}

//event.type должен быть keypress
//довідкова
function getChar(event) {
	  
//	console.log(event);
	
	if (event.which == null) { // IE
	    if (event.keyCode < 32) return null; // спец. символ
	    return String.fromCharCode(event.keyCode)
	  }

	  if (event.which != 0 && event.charCode != 0) { // все кроме IE
	    if (event.which < 32) return null; // спец. символ
	    return String.fromCharCode(event.which); // остальные
	  }

	  return null; // спец. символ
}

function onkeypressDialogs(e) {
	 var keynum = "";

	if(window.event) // IE
	 {
	  keynum = e.keyCode;
	 }
	 else if(e.which) // Netscape/Firefox/Opera
	 {
	  keynum = e.which;
	 }
	 if(keynum == 13) {
        $(":input")[$(":input").index(document.activeElement) + 1].focus();
        e.preventDefault();
	 }
	

}
